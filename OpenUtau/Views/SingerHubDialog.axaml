<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:OpenUtau.App.ViewModels"
        xmlns:doc="using:Avalonia.Controls.Documents"
        mc:Ignorable="d"
        x:Class="OpenUtau.App.Views.SingerHubDialog"
        Icon="/Assets/open-utau.ico"
        Title="{DynamicResource lunai.caption}" Width="720" Height="560" WindowStartupLocation="CenterScreen">
  <Design.DataContext>
    <vm:SingerHubViewModel/>
  </Design.DataContext>
  <Grid Margin="12">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
      <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>

    <TabControl Grid.Row="0" SelectedIndex="{Binding SelectedTabIndex}" Margin="0,0,0,10">
      <TabItem Header="{DynamicResource lunai.tab.all}"/>
      <TabItem Header="{DynamicResource lunai.tab.lunai}"/>
      <TabItem Header="{DynamicResource lunai.tab.ufr}"/>
      <TabItem Header="{DynamicResource lunai.tab.brapa}"/>
    </TabControl>

    <TextBox Grid.Row="1" Watermark="{DynamicResource lunai.search}" Text="{Binding SearchText}" Margin="0,0,0,10"/>

    <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Padding="0,0,12,0">
      <ItemsControl ItemsSource="{Binding FilteredRows}" Margin="0,0,4,4">
        <ItemsControl.ItemTemplate>
          <DataTemplate x:DataType="vm:SingerHubRowViewModel">
            <Border Margin="0,0,0,8" Padding="12,10" CornerRadius="6"
                    Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
                    BorderBrush="{DynamicResource SystemControlHighlightBaseMediumLowBrush}"
                    BorderThickness="1">
              <Grid ColumnDefinitions="Auto,*,Auto" RowDefinitions="Auto">
                <Border Grid.Column="0" Width="56" Height="56" CornerRadius="4" Margin="0,0,12,0"
                        Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"
                        ClipToBounds="True">
                  <Image Source="{Binding IconBitmap}" Width="56" Height="56" Stretch="UniformToFill"/>
                </Border>
                <StackPanel Grid.Column="1" VerticalAlignment="Center" Spacing="2">
                  <StackPanel Orientation="Horizontal" Spacing="6">
                    <TextBlock Text="{Binding Name}" FontWeight="SemiBold" FontSize="14"/>
                    <TextBlock Text="{Binding TypeDisplay}" FontSize="11" Opacity="0.75" VerticalAlignment="Center"/>
                  </StackPanel>
                  <ItemsControl ItemsSource="{Binding VersionStatusSegments}" FontSize="12" Opacity="0.9">
                    <ItemsControl.ItemsPanel>
                      <ItemsPanelTemplate>
                        <StackPanel Orientation="Horizontal" Spacing="0"/>
                      </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                      <DataTemplate x:DataType="vm:VersionStatusSegment">
                        <TextBlock Text="{Binding Text}" FontWeight="{Binding SegmentFontWeight}"/>
                      </DataTemplate>
                    </ItemsControl.ItemTemplate>
                  </ItemsControl>
                  <StackPanel Orientation="Horizontal" Spacing="4" VerticalAlignment="Center">
                    <TextBlock Text="{Binding Company}" FontSize="12" Opacity="0.75"
                               IsVisible="{Binding HasCompany}"/>
                    <TextBlock Text=" | " FontSize="12" Opacity="0.75"
                               IsVisible="{Binding ShowCompanyPageSeparator}"/>
                    <TextBlock FontSize="12" Cursor="Hand" IsVisible="{Binding HasPageLink}"
                               PointerPressed="OnOpenPageClick">
                      <TextBlock.Inlines>
                        <doc:Underline Foreground="{DynamicResource AccentBrush1}">
                          <doc:Run Text="{DynamicResource lunai.openpage}" Foreground="{DynamicResource AccentBrush1}"/>
                        </doc:Underline>
                      </TextBlock.Inlines>
                    </TextBlock>
                  </StackPanel>
                </StackPanel>
                <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="6" VerticalAlignment="Center">
                  <Button Content="{DynamicResource lunai.install}" Click="OnPrimaryActionClick"
                          IsVisible="{Binding CanInstall}"/>
                </StackPanel>
              </Grid>
            </Border>
          </DataTemplate>
        </ItemsControl.ItemTemplate>
      </ItemsControl>
    </ScrollViewer>

    <StackPanel Grid.Row="3" Orientation="Horizontal" Spacing="12" Margin="0,10,0,0">
      <TextBlock Text="{Binding Status}" VerticalAlignment="Center" Opacity="0.9"/>
      <Button Content="{DynamicResource lunai.refresh}" Command="{Binding RefreshCommand}"/>
    </StackPanel>
  </Grid>
</Window>

